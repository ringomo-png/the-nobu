<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>THE NOBLE | MUSIC</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Roboto+Mono:wght@300;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg-color: #000; --text-muted: #86868b; }
        body { margin: 0; background-color: var(--bg-color); color: #fff; font-family: 'Inter', -apple-system, sans-serif; overflow-x: hidden; overflow-y: auto; }

        /* BACKボタン */
        .top-nav { position: absolute; top: 0; left: 0; width: 100%; height: 90px; padding: 0 40px; box-sizing: border-box; z-index: 1000; pointer-events: none;}
        .nav-right { display: flex; align-items: center; justify-content: flex-end; height: 100%; width: 100%; pointer-events: auto;}
        .back-btn { font-family: 'Roboto Mono', monospace; font-size: 11px; color: var(--text-muted); text-decoration: none; letter-spacing: 0.2em; text-transform: uppercase; transition: color 0.3s; }
        .back-btn:hover { color: #fff; text-shadow: 0 0 5px rgba(255,255,255,0.5); }

        /* スワイプ案内 */
        .swipe-hint { margin-top: 80px; font-family: 'Roboto Mono', monospace; font-size: 10px; color: var(--text-muted); letter-spacing: 0.2em; animation: pulse 2s infinite; text-align: center; margin-bottom: 30px; }
        @keyframes pulse { 0% { opacity: 0.3; } 50% { opacity: 1; } 100% { opacity: 0.3; } }

        /* アルバムスライダー */
        .album-slider { display: flex; overflow-x: auto; scroll-snap-type: x mandatory; gap: 40px; padding: 0 40px 250px; width: 100vw; box-sizing: border-box; scroll-behavior: smooth; }
        .album-slider::-webkit-scrollbar { display: none; }
        
        .album-card { flex: 0 0 85vw; max-width: 400px; scroll-snap-align: center; display: flex; flex-direction: column; align-items: center; }
        .album-cover { width: 65%; max-width: 250px; aspect-ratio: 1/1; object-fit: cover; border-radius: 4px; filter: grayscale(100%) contrast(110%) brightness(0.8); box-shadow: 0 10px 30px rgba(0,0,0,0.8); margin-bottom: 25px; transition: 0.5s; }
        .album-card.active-album .album-cover { filter: grayscale(0%) contrast(100%) brightness(1); box-shadow: 0 10px 40px rgba(255,255,255,0.1); }
        
        .album-title { font-family: 'Inter', sans-serif; font-size: 22px; font-weight: 900; letter-spacing: 0.1em; margin: 0 0 15px 0; text-align: center; }
        
        .track-list-wrapper { width: 100%; border-top: 1px solid #222; }
        .track-list { width: 100%; list-style: none; padding: 0; margin: 0; }
        .track-item { padding: 15px 10px; border-bottom: 1px solid #222; font-family: 'Inter', sans-serif; font-size: 13px; letter-spacing: 0.05em; color: var(--text-muted); cursor: pointer; transition: 0.3s; display: flex; justify-content: space-between; align-items: center; pointer-events: auto; }
        .track-item:hover { color: #fff; background: rgba(255,255,255,0.05); }
        .track-item.playing { color: #34c759; font-weight: 700; background: rgba(52, 199, 89, 0.05); }

        /* プレイヤーUI */
        .player-wrapper { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); display: flex; flex-direction: column; align-items: center; gap: 12px; z-index: 100; width: 90%; max-width: 360px; pointer-events: none; }
        
        .now-playing-bar { display: flex; align-items: center; justify-content: space-between; width: 100%; background: rgba(10, 10, 10, 0.85); padding: 12px 20px; border-radius: 12px; border: 1px solid rgba(52, 199, 89, 0.3); box-shadow: 0 5px 20px rgba(0,0,0,0.8), 0 0 10px rgba(52, 199, 89, 0.05); backdrop-filter: blur(10px); box-sizing: border-box; pointer-events: auto; }
        #now-playing-text { font-family: 'Roboto Mono', monospace; font-size: 11px; color: #34c759; letter-spacing: 0.1em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex: 1; text-shadow: 0 0 5px rgba(52, 199, 89, 0.5); margin-right: 15px; }
        .time-and-wave { display: flex; align-items: center; gap: 12px; }
        #time-display { font-family: 'Roboto Mono', monospace; font-size: 10px; color: var(--text-muted); letter-spacing: 0.1em; }

        .mini-wave { display: flex; align-items: flex-end; gap: 3px; height: 10px; }
        .wave-bar { width: 2px; background-color: #34c759; border-radius: 1px; animation: waveAnim 1s infinite ease-in-out; }
        .wave-bar:nth-child(1) { animation-delay: 0.0s; height: 60%; }
        .wave-bar:nth-child(2) { animation-delay: 0.2s; height: 100%; }
        .wave-bar:nth-child(3) { animation-delay: 0.4s; height: 80%; }
        @keyframes waveAnim { 0%, 100% { transform: scaleY(0.5); } 50% { transform: scaleY(1); } }
        .mini-wave.playing .wave-bar { animation-play-state: running; }
        .mini-wave.paused .wave-bar { animation-play-state: paused; transform: scaleY(0.3); }

        .audio-player { display: flex; align-items: center; justify-content: center; gap: 20px; background: rgba(0,0,0,0.85); padding: 10px 30px; border-radius: 50px; backdrop-filter: blur(10px); box-shadow: 0 10px 30px rgba(0,0,0,0.9); border: 1px solid #333; pointer-events: auto; }
        .track-btn { background: transparent; border: none; color: rgba(255,255,255,0.5); display: flex; justify-content: center; align-items: center; cursor: pointer; transition: all 0.2s; padding: 10px; }
        .track-btn:hover { color: #fff; transform: scale(1.1); filter: drop-shadow(0 0 5px rgba(255,255,255,0.4)); }
        .track-btn.active { color: #fff; filter: drop-shadow(0 0 5px rgba(255,255,255,0.8)); }
        .ctrl-icon { width: 18px; height: 18px; display: block; }
        .repeat-one-text { font-family: sans-serif; font-size: 7px; font-weight: bold; }
        .play-btn { width: 52px; height: 52px; border-radius: 50%; background: #ffffff; border: none; color: #000000; display: flex; justify-content: center; align-items: center; cursor: pointer; box-shadow: 0 0 15px rgba(255, 255, 255, 0.2); transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); padding: 0; }
        .play-btn:hover { transform: scale(1.08); box-shadow: 0 0 25px rgba(255, 255, 255, 0.5); }
        .play-btn:active { transform: scale(0.92); }
    </style>
</head>
<body>

    <div class="top-nav">
        <div class="nav-right"><a href="index.html" class="back-btn">[ BACK ]</a></div>
    </div>

    <div class="swipe-hint">&lt; SWIPE TO CHANGE ALBUM &gt;</div>

    <audio id="bgm" preload="auto"></audio>

    <div class="album-slider">
        <div class="album-card" id="card-white">
            <img src="image_top.png" class="album-cover">
            <h3 class="album-title">LOGICAL DRIVE</h3>
            <div class="track-list-wrapper">
                <ul class="track-list" id="list-white">
                    <li class="track-item" onclick="playSpecific(0, 'white')"><span>1. System Overwrite</span></li>
                    <li class="track-item" onclick="playSpecific(1, 'white')"><span>2. Local Infrastructure</span></li>
                    <li class="track-item" onclick="playSpecific(2, 'white')"><span>3. Blank State</span></li>
                    <li class="track-item" onclick="playSpecific(3, 'white')"><span>4. History Log (About)</span></li>
                    <li class="track-item" onclick="playSpecific(4, 'white')"><span>5. Deep Belonging (Belong)</span></li>
                    <li class="track-item" onclick="playSpecific(5, 'white')"><span>6. Visual Archive (Gallery)</span></li>
                </ul>
            </div>
        </div>
        
        <div class="album-card" id="card-black">
            <img src="image_hiphop.png" class="album-cover">
            <h3 class="album-title">PHYSICAL DRIVE</h3>
            <div class="track-list-wrapper">
                <ul class="track-list" id="list-black">
                    <li class="track-item" onclick="playSpecific(0, 'black')"><span>1. Midnight Sabotage</span></li>
                    <li class="track-item" onclick="playSpecific(1, 'black')"><span>2. Identity Masking</span></li>
                    <li class="track-item" onclick="playSpecific(2, 'black')"><span>3. Anatomic Defense</span></li>
                    <li class="track-item" onclick="playSpecific(3, 'black')"><span>4. Velocity Override</span></li>
                    <li class="track-item" onclick="playSpecific(4, 'black')"><span>5. Fatal Exception</span></li>
                </ul>
            </div>
        </div>
    </div>

    <div class="player-wrapper">
        <div class="now-playing-bar">
            <div id="now-playing-text"></div>
            <div class="time-and-wave">
                <span id="time-display">0:00 / 0:00</span>
                <div class="mini-wave paused" id="mini-wave">
                    <div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div>
                </div>
            </div>
        </div>

        <div class="audio-player" id="audio-player">
            <button class="track-btn" id="shuffle-btn" title="Shuffle"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ctrl-icon"><polyline points="16 3 21 3 21 8"></polyline><line x1="4" y1="20" x2="21" y2="3"></line><polyline points="21 16 21 21 16 21"></polyline><line x1="15" y1="15" x2="21" y2="21"></line><line x1="4" y1="4" x2="9" y2="9"></line></svg></button>
            <button class="track-btn" id="prev-btn" title="Previous"><svg viewBox="0 0 24 24" fill="currentColor" class="ctrl-icon"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg></button>
            <button class="play-btn" id="play-btn">
                <span class="play-icon" id="play-icon"><svg viewBox="0 0 24 24" fill="currentColor" style="width:20px; height:20px; margin-left: 1px;"><path d="M8 5v14l11-7z"/></svg></span>
            </button>
            <button class="track-btn" id="next-btn" title="Next"><svg viewBox="0 0 24 24" fill="currentColor" class="ctrl-icon"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/></svg></button>
            <button class="track-btn active" id="repeat-btn" title="Repeat Mode"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ctrl-icon" id="repeat-icon"><polyline points="17 1 21 5 17 9"></polyline><path d="M3 11V9a4 4 0 0 1 4-4h14"></path><polyline points="7 23 3 19 7 15"></polyline><path d="M21 13v2a4 4 0 0 1-4 4H3"></path></svg></button>
        </div>
    </div>

    <script>
        if (sessionStorage.getItem('has_rebooted_ever') !== 'true') { window.location.href = 'index.html'; }

        const whiteFiles = ['main1.sound.MOV', 'main2.sound.MOV', 'main3.sound.MOV', 'about.sound.MOV', 'more.music.MOV', 'photo.music.MOV'];
        const whiteTitles = ['System Overwrite', 'Local Infrastructure', 'Blank State', 'History Log', 'Deep Belonging', 'Visual Archive'];
        
        const blackFiles = ['hiphop1.sound.MOV', 'hiphop2.sound.MOV', 'hiphop3.sound.MOV', 'hiphop4.sound.MOV', 'hiphop5.sound.MOV'];
        const blackTitles = ['Midnight Sabotage', 'Identity Masking', 'Anatomic Defense', 'Velocity Override', 'Fatal Exception'];

        const bgm = document.getElementById('bgm');
        let currentAlbum = 'white';
        let currentPlaylist = whiteFiles;
        let currentTitles = whiteTitles;
        let trackIdx = 0;
        let isPlaying = false;
        let isShuffle = false;
        let repeatMode = 1; 

        const playBtn = document.getElementById('play-btn');
        const playIcon = document.getElementById('play-icon');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const shuffleBtn = document.getElementById('shuffle-btn');
        const repeatBtn = document.getElementById('repeat-btn');
        const repeatIcon = document.getElementById('repeat-icon');
        const nowPlayingText = document.getElementById('now-playing-text');
        const timeDisplay = document.getElementById('time-display');
        const miniWave = document.getElementById('mini-wave');
        
        const playSvg = '<svg viewBox="0 0 24 24" fill="currentColor" style="width:20px; height:20px; margin-left: 1px;"><path d="M8 5v14l11-7z"/></svg>';
        const pauseSvg = '<svg viewBox="0 0 24 24" fill="currentColor" style="width:20px; height:20px; margin-left: 0px;"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>';
        const svgRepeatAll = `<polyline points="17 1 21 5 17 9"></polyline><path d="M3 11V9a4 4 0 0 1 4-4h14"></path><polyline points="7 23 3 19 7 15"></polyline><path d="M21 13v2a4 4 0 0 1-4 4H3"></path>`;
        const svgRepeatOne = `<polyline points="17 1 21 5 17 9"></polyline><path d="M3 11V9a4 4 0 0 1 4-4h14"></path><polyline points="7 23 3 19 7 15"></polyline><path d="M21 13v2a4 4 0 0 1-4 4H3"></path><text x="12" y="16" class="repeat-one-text" text-anchor="middle" fill="currentColor" stroke="none">1</text>`;

        bgm.src = currentPlaylist[trackIdx];
        nowPlayingText.innerText = currentTitles[trackIdx];

        function formatTime(seconds) {
            if (isNaN(seconds)) return "0:00";
            const min = Math.floor(seconds / 60);
            const sec = Math.floor(seconds % 60);
            return min + ":" + (sec < 10 ? "0" + sec : sec);
        }

        bgm.addEventListener('timeupdate', () => { timeDisplay.innerText = formatTime(bgm.currentTime) + " / " + formatTime(bgm.duration); });
        bgm.addEventListener('loadedmetadata', () => { timeDisplay.innerText = formatTime(bgm.currentTime) + " / " + formatTime(bgm.duration); });

        function updatePlayState() {
            if (isPlaying) { 
                playIcon.innerHTML = pauseSvg; 
                bgm.play().catch(e => console.log(e)); 
                miniWave.classList.remove('paused');
                miniWave.classList.add('playing');
            } else { 
                playIcon.innerHTML = playSvg; 
                bgm.pause(); 
                miniWave.classList.remove('playing');
                miniWave.classList.add('paused');
            }
            updateHighlight();
        }

        function updateHighlight() {
            document.querySelectorAll('.track-item').forEach(el => el.classList.remove('playing'));
            document.getElementById('card-white').classList.remove('active-album');
            document.getElementById('card-black').classList.remove('active-album');
            
            if(isPlaying) {
                const listId = currentAlbum === 'white' ? 'list-white' : 'list-black';
                const list = document.getElementById(listId);
                if(list.children[trackIdx]) list.children[trackIdx].classList.add('playing');
                document.getElementById('card-' + currentAlbum).classList.add('active-album');
            }
        }

        function playSpecific(idx, album) {
            currentAlbum = album;
            currentPlaylist = album === 'white' ? whiteFiles : blackFiles;
            currentTitles = album === 'white' ? whiteTitles : blackTitles;
            trackIdx = idx;
            bgm.src = currentPlaylist[trackIdx];
            nowPlayingText.innerText = currentTitles[trackIdx];
            isPlaying = true;
            updatePlayState();
        }

        playBtn.addEventListener('click', () => { isPlaying = !isPlaying; updatePlayState(); });
        shuffleBtn.addEventListener('click', () => { isShuffle = !isShuffle; shuffleBtn.classList.toggle('active', isShuffle); });
        
        repeatBtn.addEventListener('click', () => { 
            repeatMode = (repeatMode + 1) % 3;
            if (repeatMode === 0) { repeatBtn.classList.remove('active'); repeatIcon.innerHTML = svgRepeatAll; } 
            else if (repeatMode === 1) { repeatBtn.classList.add('active'); repeatIcon.innerHTML = svgRepeatAll; } 
            else { repeatBtn.classList.add('active'); repeatIcon.innerHTML = svgRepeatOne; }
        });

        const changeTrack = (direction) => {
            if (isShuffle) {
                let nextIdx = trackIdx;
                if (currentPlaylist.length > 1) { while(nextIdx === trackIdx) nextIdx = Math.floor(Math.random() * currentPlaylist.length); }
                trackIdx = nextIdx;
            } else { trackIdx = (trackIdx + direction + currentPlaylist.length) % currentPlaylist.length; }
            bgm.src = currentPlaylist[trackIdx];
            nowPlayingText.innerText = currentTitles[trackIdx];
            bgm.currentTime = 0;
            if (isPlaying) bgm.play().catch(e => {});
            updateHighlight();
        };

        prevBtn.addEventListener('click', () => changeTrack(-1));
        nextBtn.addEventListener('click', () => changeTrack(1));

        bgm.addEventListener('ended', () => { 
            if (repeatMode === 2) { bgm.currentTime = 0; bgm.play().catch(e=>{}); } 
            else if (repeatMode === 1) { changeTrack(1); } 
            else { isPlaying = false; updatePlayState(); }
        });
    </script>
</body>
</html>
